<div class="container-fluid orders-page p-0">
  <!-- Title row -->
  <div class="d-flex align-items-center justify-content-between page-heading bg-white px-3 py-3 border-bottom">
    <div class="d-flex align-items-center gap-2">
      <i class="fa-solid fa-file-invoice fs-4 text-primary"></i>
      <h1 class="h5 m-0 fw-bold">Trang danh sách đơn hàng</h1>
    </div>
  </div>

  <!-- Search -->
  <div class="row g-2 align-items-center px-3 py-3 bg-light-subtle">
    <div class="col-md-8">
      <div class="input-group shadow-sm">
        <span class="input-group-text border-end-0">
          <i class="fa-solid fa-magnifying-glass"></i>
        </span>
        <input
          type="text"
          class="form-control search-input border-start-0"
          placeholder="Tìm đơn hàng"
          [(ngModel)]="keyword"
          (keyup.enter)="searchOrders()"
        />
      </div>
    </div>
    <div class="col-md-4 text-md-start text-end">
      <button class="btn btn-primary px-3 shadow-sm" (click)="searchOrders()">
        <i class="fa-solid fa-magnifying-glass me-1"></i> Tìm kiếm
      </button>
    </div>
  </div>

  <!-- Content card -->
  <div class="px-3 py-3">
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body p-0">
        <div class="table-responsive table-sticky-wrap">
          <table class="table table-hover table-striped align-middle m-0">
            <thead class="table-light sticky-top">
              <tr>
                <th class="text-nowrap">ID</th>
                <th class="text-nowrap">Tên</th>
                <th class="text-nowrap">Email</th>
                <th class="text-nowrap">SĐT</th>
                <th class="text-nowrap">Địa chỉ</th>
                <th class="text-nowrap">Note</th>
                <th class="text-nowrap">Ngày đặt</th>
                <th class="text-nowrap">Status</th>
                <th class="text-nowrap">Giá</th>
                <th class="text-nowrap">Shipped</th>
                <th class="text-nowrap">Địa chỉ nhận</th>
                <th class="text-nowrap">Ngày gửi</th>
                <th class="text-nowrap">Thanh toán</th>
                <th class="text-nowrap text-center">Hành động</th>
              </tr>
            </thead>
            <tbody *ngIf="orders?.length; else emptyState">
              <tr *ngFor="let order of orders; trackBy: trackByOrderId">
                <td class="text-muted fw-semibold">{{ order.id }}</td>
                <td class="text-truncate" style="max-width: 160px">{{ order.fullname }}</td>
                <td class="text-truncate" style="max-width: 200px">{{ order.email }}</td>
                <td class="text-nowrap">{{ order.phone_number }}</td>
                <td class="text-truncate" style="max-width: 220px">{{ order.address }}</td>
                <td class="text-truncate" style="max-width: 180px">{{ order.note }}</td>
                <td class="text-nowrap">{{ order.order_date | date : "dd/MM/yyyy" }}</td>
                <td>
                  <span
                    class="badge status-badge text-capitalize"
                    [ngClass]="{
                      'bg-secondary': order.status === 'pending',
                      'bg-primary': order.status === 'processing',

                      'bg-info':
                        order.status === 'shipped' ||
                        order.status === 'shipping' ||
                        order.status === 'waiting_for_stock',
                      'bg-warning text-dark': order.status === 'out_of_stock_pending',

                      'bg-success': order.status === 'delivered',
                      'bg-danger':
                        order.status === 'cancelled' ||
                        order.status === 'cancelled_out_of_stock',
                      'bg-dark': order.status === 'refused_on_delivery'
                    }"
                  >
                    {{ order.status }}
                  </span>
                </td>
                <td class="text-nowrap fw-semibold">{{ order.total_money }} đ</td>
                <td class="text-truncate" style="max-width: 140px">{{ order.shipping_method }}</td>
                <td class="text-truncate" style="max-width: 220px">{{ order.shipping_address }}</td>
                <td class="text-nowrap">{{ order.shipping_date | date : "dd/MM/yyyy" }}</td>
                <td class="text-truncate" style="max-width: 140px">{{ order.payment_method }}</td>
                <td class="text-center">
                  <button (click)="viewDetails(order)" class="btn btn-outline-primary btn-sm">
                    <i class="fa-regular fa-eye me-1"></i> Xem
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty state -->
        <ng-template #emptyState>
          <div class="p-5 text-center text-muted">
            <i class="fa-regular fa-file-lines d-block mb-2" style="font-size: 40px;"></i>
            Không có hóa đơn nào để hiển thị.
          </div>
        </ng-template>
      </div>

      <!-- Pagination -->
      <div class="card-footer bg-white">
        <nav class="d-flex justify-content-center" aria-label="Page navigation">
          <ul class="pagination pagination-pills m-0">
            <li class="page-item" *ngIf="currentPage > 0">
              <a class="page-link" (click)="onPageChange(0)">First</a>
            </li>
            <li class="page-item" *ngIf="currentPage > 0">
              <a class="page-link" (click)="onPageChange(currentPage - 1)">Previous</a>
            </li>

            <ng-container *ngFor="let page of visiblePages">
              <li class="page-item" [ngClass]="{ active: page === currentPage + 1 }">
                <a class="page-link" (click)="onPageChange(page - 1)">{{ page }}</a>
              </li>
            </ng-container>

            <li class="page-item" *ngIf="currentPage < totalPages - 1">
              <a class="page-link" (click)="onPageChange(currentPage + 1)">Next</a>
            </li>
            <li class="page-item" *ngIf="currentPage < totalPages - 1">
              <a class="page-link" (click)="onPageChange(totalPages - 1)">Last</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
